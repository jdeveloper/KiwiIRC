<style>
    #color-picker li {
        list-style: none;
        float: left;
        width: 20px;
    }

    #color-picker ul {
        width: 80px;
        position: absolute;
    }
</style>

<div id="color-picker" class="tool">
    <img src="../kiwi/assets/img/color_picker.png">
    <ul>
        <li data-color="0" style="background-color: #FFFFFF">&nbsp;</li>
        <li data-color="1" style="background-color: #000000">&nbsp;</li>
        <li data-color="2" style="background-color: #000080">&nbsp;</li>
        <li data-color="3" style="background-color: #008000">&nbsp;</li>
        <li data-color="4" style="background-color: #FF0000">&nbsp;</li>
        <li data-color="5" style="background-color: #800040">&nbsp;</li>
        <li data-color="6" style="background-color: #800080">&nbsp;</li>
        <li data-color="7" style="background-color: #FF8040">&nbsp;</li>
        <li data-color="8" style="background-color: #FFFF00">&nbsp;</li>
        <li data-color="9" style="background-color: #80FF00">&nbsp;</li>
        <li data-color="10" style="background-color: #008080">&nbsp;</li>
        <li data-color="11" style="background-color: #00FFFF">&nbsp;</li>
        <li data-color="12" style="background-color: #0000FF">&nbsp;</li>
        <li data-color="13" style="background-color: #FF55FF">&nbsp;</li>
        <li data-color="14" style="background-color: #808080">&nbsp;</li>
        <li data-color="16" style="background-color: #C0C0C0">&nbsp;</li>

    </ul>
</div>

<script type="text/javascript">
    
    (function () {
        var network = kiwi.components.Network();
        var control = kiwi.components.ControlInput();
        var selected_color = null;

        var $icon = $('#color-picker');
        var $colors = $icon.find('ul');

        var setColorsPosition = function() {
            $colors.css('top', (-($icon.position().top + $icon.height() + 80))+'px');
            $colors.css('left', ($icon.position().left - 40)+'px');
        };

        $input = $("#kiwi #controlbox textarea");

        $colors.hide();

        $icon.click(function(e){
            $colors.show();
        });

        //we need to hide the color box every time we click outside of the color list
        $(document).click(function(e) {
            if(e.target != $icon.find('img:first')[0]) {
                $colors.hide();
            }
        });

        $colors.find('li').click(function(e){
            e.stopPropagation();

            $this = $(this);
            $input.css('color', $this.css('background-color'));
            selected_color = $this.data('color');
            $this.parent().hide();
        });

        control.addCommandDecorator(function(command){
            if(command.command == "msg" && selected_color && command.params[1]) {
                command.params[1] = '\x03' + selected_color +command.params[1];
            }
        });

        control.addPluginIcon($icon);
        setColorsPosition();

        $icon.OnPositionChange(setColorsPosition);
    })();
</script>
